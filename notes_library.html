<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notes Gallery - Notes Library</title>

    <!-- Css File -->
    <link rel="stylesheet" href="assets/css/style.css" />

    <!-- Favicon Link -->
    <link
      rel="icon"
      type="image/png"
      href="assets/images/logo_icon.png"
      sizes="16x16"
    />

    <!-- Bootstrap Css Link -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />

    <!-- owlCarousel css links -->
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="assets/css/owl.theme.default.min.css" />

    <!-- Google Fonts Links  -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- fontawesome icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Grid.js Css File -->
    <link rel="stylesheet" href="assets/css/mermaid.min.css" />

    <!-- Bootstrap select css  -->
    <link rel="stylesheet" href="assets/css/bootstrap-select.css" />
  </head>
  <body>
    <main id="notes-library-page">
      <!-- Header Section Starts -->
      <section id="header-section" class="px-4 shadow-sm">
        <nav class="navbar navbar-expand-lg">
          <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
              <img src="assets/images/logo_icon.png" alt="icon" />
              <h5 class="mb-0 ms-2">Notes Gallery</h5>
            </a>
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNav"
              aria-controls="navbarNav"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div
              class="collapse navbar-collapse justify-content-end"
              id="navbarNav"
            >
              <ul class="navbar-nav pt-2 ps-3 ps-md-4">
                <li class="nav-item">
                  <a class="nav-link me-3 text-black" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link me-3 text-black" href="notes_library.html"
                    >Notes Library</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="d-lg-block d-none nav-link me-3 text-black theme-btn rounded-pill px-3 py-2 font-work-sans"
                    href="login.html"
                    >Login</a
                  >
                  <a
                    class="nav-link d-lg-none me-3 text-black"
                    href="login.html"
                    >Login</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="d-lg-block d-none nav-link me-3 text-black theme-btn rounded-pill px-3 py-2 font-work-sans"
                    href="register.html"
                    >Register</a
                  >
                  <a
                    class="nav-link d-lg-none me-3 text-black"
                    href="register.html"
                    >Register</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </section>
      <!-- Header Section Ends -->

      <!-- Library Section Starts -->
      <section id="library-section" class="py-5">
        <div class="container-fluid px-5">
          <div class="row">
            <div class="col-lg-3 col-12">
              <h4 class="fw-bold fs-22">Filters</h4>
              <form action="#" class="mb-md-5">
                <div class="row">
                  <div class="col-lg-12 col-md-6">
                    <div class="mb-3 mt-4">
                      <label for="stream" class="form-label">Stream</label>
                      <select
                        name="stream"
                        id="stream"
                        class="form-control selectpicker rounded-4 fs-sm-14"
                        data-live-search="true"
                      ></select>
                    </div>
                  </div>
                  <div class="col-lg-12 col-md-6">
                    <div class="mb-3 mt-md-4 mt-lg-0">
                      <label for="course" class="form-label">Course</label>
                      <select
                        name="course"
                        id="course"
                        class="form-control selectpicker rounded-4 fs-sm-14"
                        data-live-search="true"
                      ></select>
                    </div>
                  </div>
                  <div class="col-lg-12 col-md-6">
                    <div class="mb-3">
                      <label for="semester" class="form-label">Semester</label>
                      <select
                        name="semester"
                        id="semester"
                        class="form-control selectpicker rounded-4 fs-sm-14"
                        data-live-search="true"
                      ></select>
                    </div>
                  </div>
                  <div class="col-lg-12 col-md-6">
                    <div class="mb-4">
                      <label for="sort" class="form-label">Sort</label>
                      <select
                        name="sort"
                        id="sort"
                        class="form-control selectpicker rounded-4 fs-sm-14"
                        data-live-search="true"
                      >
                        <option value="1">Newest To Oldest</option>
                        <option value="2">Oldest to Newest</option>
                        <option value="3">Alphabetically (Title)</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-lg-12 col-md-6">
                    <button
                      class="btn apply-filters theme-btn rounded-pill fw-bold fs-14 py-2 px-3"
                    >
                      Apply Filters
                    </button>
                  </div>
                </div>
              </form>
            </div>
            <div class="col-lg-9 col-12">
              <div class="section-title">
                <h2 class="fw-bold">Notes Library</h2>
                <p class="form-control-text-color fs-14">
                  Explore notes from various courses and contributors.
                </p>
              </div>
              <form action="#" class="position-relative">
                <span
                  class="d-inline-block position-absolute top-0 left-0 bottom-0 align-content-center px-2"
                >
                  <i
                    class="fa-solid fa-magnifying-glass fs-22 form-control-text-color px-2 pt-1"
                  ></i>
                </span>
                <input
                  type="text"
                  id="search_notes_input"
                  name="search_notes_input"
                  placeholder="Search  for notes by title, course, or subject"
                  class="form-control border-0 py-3 ps-5 rounded-3 bg-body-secondary fs-sm-14"
                />
              </form>
              <div class="featured-notes">
                <h5 class="fw-bold fs-18 my-4 ps-2">Featured Notes</h5>
                <div class="owl-carousel"></div>
              </div>
              <div class="all-notes">
                <h5 class="fw-bold fs-18 my-4 ps-2">All Notes</h5>
                <div id="table-wrapper" class="overflow-hidden"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Library Section Ends -->

      <!-- Footer Section Starts -->
      <section id="footer-section" class="pb-4 pt-md-5 pt-4 mt-lg-3">
        <div class="container">
          <div class="row">
            <div class="col-md-4 col-6 text-center">
              <a href="about.html" class="text-decoration-none text-black-50 fs-sm-14">About Us</a>
            </div>
            <div class="col-md-4 col-6 text-center">
              <a href="contact.html" class="text-decoration-none text-black-50 fs-sm-14">Contact Us</a>
            </div>
            <div class="col-md-4 col-12 text-center">
              <a href="privacy_policy.html" class="text-decoration-none text-black-50 fs-sm-14">Privacy Policy</a>
            </div>
            <div class="col-lg-12">
              <p class="text-black-50 text-center fs-sm-14 my-3">
                &copy;2025 Notes Gallery. All rights reserved.
              </p>
            </div>
          </div>
        </div>
      </section>
      <!-- Footer Section Ends -->

      <!-- Modal Box Starts -->
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content w-100">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">
                Modal title
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body"></div>
          </div>
        </div>
      </div>
      <!-- Modal Box Ends -->
    </main>

    <script src="assets/js/jquery-3.7.1.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/bootstrap-select.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <script src="assets/js/gridjs.umd.js"></script>
    <script src="assets/js/sweetalert2.all.min.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- Get Features Notes and Owl Carousel Script -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let carousel = document.querySelector(".owl-carousel");
        fetch(`${API_BASE_URL}/notes/get-featured-notes`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then(async (res) => {
            return res.json();
          })
          .then((data) => {
            if (data.success) {
              carousel.innerHTML = "";
              data.data.map((note) => {
                carousel.innerHTML += `
                <div class="card border-0 px-2 cursor-pointer" onclick="buildModal('${
                  note.title
                }','${
                  note.file_url
                }','${true}')" data-bs-toggle="modal" data-bs-target="#exampleModal">
                <div class="card-img rounded-3 border border-1 overflow-hidden position-relative">
                  <img
                  src="${note.thumbnail}"
                  alt="icon"
                  class="w-100 h-100"
                  />
                </div>
                <div class="card-text pt-3">
                  <p class="fs-16 fw-medium mb-1 text-capitalize">${
                    note.title
                  }${
                  note.is_verified
                    ? `<button type="button" data-bs-custom-class="custom-tooltip" class="btn p-0 border-0 bg-transparent ms-2 pe-2 text-success" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Verified"><i class="fa-solid fa-circle-check"></i></button>`
                    : ""
                }</p>
                  <p class="form-control-text-color">
                  <span class="text-capitalize">${note.course.name.toLowerCase()}</span>, ${
                  note.semester ? note.semester : note.year
                }${
                  (note.semester || note.year) === 1
                    ? "st"
                    : (note.semester || note.year) === 2
                    ? "nd"
                    : (note.semester || note.year) === 3
                    ? "rd"
                    : "th"
                } ${note.semester ? "semester" : "year"}
                  </p>
                </div>
                </div>
              `;
              });

              $(document).ready(function () {
                $(carousel).owlCarousel({
                  loop: true,
                  margin: 10,
                  nav: false,
                  autoplay: true,
                  dots: false,
                  autoplayTimeout: 4000,
                  autoplaySpeed: 1200,
                  autoplayHoverPause: true,
                  responsive: {
                    0: { items: 1 },
                    600: { items: 3 },
                    1000: { items: 4 },
                  },
                });
              });
            } else {
              fireSweetAlert({
                success: data.success,
                message: data.message || "Something Went Wrong",
              });
            }
          });

        function buildFeaturedModal(title, file_url) {}
      });
    </script>

    <!-- Data Table Script Starts -->
    <script>
      let stream = document.querySelector("#stream");
      let course = document.querySelector("#course");
      let semester = document.querySelector("#semester");
      let sort = document.querySelector("#sort");

      const grid = new gridjs.Grid({
        columns: ["Title", "Course", "Semester / Year", "Action"],
        server: {
          url: `${API_BASE_URL}/notes/get-notes`,
          then: (data) =>
            data.data.docs.map((note) => [
              gridjs.html(
                `<span class="text-capitalize">${note.title}${
                  note.is_verified
                    ? `<button type="button" data-bs-custom-class="custom-tooltip" class="btn p-0 border-0 bg-transparent ms-2 pe-2 text-success" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Verified"><i class="fa-solid fa-circle-check"></i></button>`
                    : ""
                }`
              ),
              note.course.name,
              `${note.semester ? note.semester : note.year}${
                (note.semester || note.year) === 1
                  ? "st"
                  : (note.semester || note.year) === 2
                  ? "nd"
                  : (note.semester || note.year) === 3
                  ? "rd"
                  : "th"
              } ${note.semester ? "semester" : "year"}`,
              gridjs.html(
                `<a href="#" onclick="buildModal('${note.title}','${note.file_url}')" data-bs-toggle="modal" data-bs-target="#exampleModal"
                class="view-btn text-decoration-none form-control-text-color fw-semibold pe-2 m-0">
                View
                </a> |
                <a href="#" onclick="downloadNote('${note.title}','${note.file_url}')" class="text-decoration-none form-control-text-color fw-semibold ps-2 m-0" >
                  Download
                </a>`
              ),
            ]),
          total: (data) => data.data.totalDocs,
        },
        pagination: {
          enabled: true,
          limit: 5,
          server: {
            url: (prev, page, limit) => {
              const separator = prev.includes("?") ? "&" : "?";
              return `${prev}${separator}limit=${limit}&page=${page}`;
            },
          },
        },
        search: {
          server: {
            url: (prev, keyword) => `${prev}?search=${keyword}`,
          },
        },
        sort: true,
      }).render(document.getElementById("table-wrapper"));

      setTimeout(() => {
        reinitializeTooltips();
      }, 1000);

      document
        .getElementById("search_notes_input")
        .addEventListener("input", function (e) {
          if (e.target.value.trim() === "") {
            document
              .querySelector(".featured-notes")
              .classList.remove("d-none");
          } else {
            document.querySelector(".featured-notes").classList.add("d-none");
          }
          const searchBox = document.querySelector(".gridjs-input");
          searchBox.value = e.target.value;

          const event = new Event("input", { bubbles: true });
          searchBox.dispatchEvent(event);
        });

      // Apply Filter Script
      let applyFilterBtn = document.querySelector(".apply-filters");
      applyFilterBtn.addEventListener("click", (e) => {
        e.preventDefault();
        document.querySelector(".featured-notes").classList.add("d-none");
        grid
          .updateConfig({
            pagination: {
              enabled: true,
              limit: 5,
              server: {
                url: (prev, page, limit) => {
                  const separator = prev.includes("?") ? "&" : "?";
                  return `${prev}${separator}limit=${limit}&page=${page}${
                    stream.value ? `&stream=${stream.value}` : ""
                  }${course.value ? `&course=${course.value}` : ""}${
                    semester.value ? `&semester=${semester.value}` : ""
                  }${sort.value ? `&sort=${sort.value}` : ""}`;
                },
              },
            },
          })
          .forceRender();
      });
    </script>
    <!-- Data Table Script Ends -->

    <!-- select filters script -->
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        let stream_select = document.querySelector("#stream");
        let course_select = document.querySelector("#course");
        let semester_select = document.querySelector("#semester");

        async function populateStreams() {
          try {
            const res = await fetch(`${API_BASE_URL}/notes/get-streams`, {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            });
            const data = await res.json();
            if (data.success) {
              let streams = data.data;
              $(stream_select).empty();
              $(stream_select).val();
              $(stream_select).append(
                '<option value="">Select Stream</option>'
              );
              streams?.forEach((stream) => {
                let option = document.createElement("option");
                option.value = stream._id;
                option.text = stream.name;
                stream_select.appendChild(option);
              });
              $(stream_select).selectpicker("refresh");
            } else {
              console.log("Streams Fetching Failed");
            }
          } catch (error) {
            console.log("Error while fetching streams : ", error);
          }
        }
        populateStreams();

        async function populateCoursesAndSemesters(stream = "") {
          try {
            const res = await fetch(
              `${API_BASE_URL}/notes/get-courses${
                stream ? `?stream=${stream}` : ""
              }`,
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );
            const data = await res.json();
            if (data.success) {
              $(course_select).selectpicker("destroy");
              $(course_select).empty();
              $(course_select).val();
              $(course_select).append(
                '<option value="">Select Course</option>'
              );
              data.data.forEach((course) => {
                let option = document.createElement("option");
                option.value = course._id;
                option.text = course.name;
                course_select.appendChild(option);
              });
              $(course_select).selectpicker("render");

              course_select.addEventListener("change", (e) => {
                $(semester_select).selectpicker("destroy");
                $(semester_select).empty();
                $(semester_select).val("");
                $(semester_select).append(
                  `<option value="">Select Semester</option>`
                );
                let selectedCourseValue = e.target.value;
                let noOfSemesters;
                let isSemester = true;
                data.data.forEach((course) => {
                  if (course._id === selectedCourseValue) {
                    noOfSemesters = course.semesters
                      ? course.semesters
                      : course.years;

                    isSemester = course.semesters ? true : false;
                  }
                });

                for (let i = 1; i <= noOfSemesters; i++) {
                  let option = document.createElement("option");
                  option.value = i;
                  option.text = `${i}${
                    i === 1 ? "st" : i === 2 ? "nd" : i === 3 ? "rd" : "th"
                  } ${isSemester ? "semester" : "year"}`;
                  semester_select.appendChild(option);
                }
                $(semester_select).selectpicker("render");
              });
            } else {
              console.log("Courses Fetching Failed");
            }
          } catch (error) {
            console.log("Error while fetching courses : ", error);
          }
        }
        // Initial population
        populateCoursesAndSemesters();

        // Populate courses when stream changes
        stream_select.addEventListener("change", function () {
          populateCoursesAndSemesters(this.value);
        });
      });
    </script>
  </body>
</html>
